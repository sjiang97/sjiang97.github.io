<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>A dialog flow app | Shaokang&#39;s Blog</title><meta name="keywords" content="Dialogflow, voice interaction, Blog"><link rel="alternate" href="/atom.xml" title="Shaokang's Blog"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css"><link href="/css/table.css" type="text/css" rel="stylesheet" media="screen,projection"><link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet"><link rel="stylesheet" href="/style.css"><script>function setLoadingBarProgress(e){document.getElementById("loading-bar").style.width=e+"%"}</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><link rel="alternate" href="/atom.xml" title="Shaokang's Blog" type="application/atom+xml"></head><body><div class="cover-wrapper"><cover class="cover post half"><h1 class="title">Shaokang's Blog</h1><div class="m_search"><form name="searchform" class="form u-search-form"><input type="text" class="input u-search-input" placeholder="search"> <i class="icon fas fa-search fa-fw"></i></form></div><div class="menu navgation"><ul class="h-list"><li><a class="nav home" href="/" id="home"><i class="fas fa-rss fa-fw"></i>&nbsp;Recent</a></li><li><a class="nav home" href="/projects/" id="projects"><i class="fas fa-code-branch fa-fw"></i>&nbsp;Projects</a></li><li><a class="nav home" href="/about/" rel="nofollow" id="about"><i class="fas fa-info-circle fa-fw"></i>&nbsp;About</a></li></ul></div></cover><header class="l_header material"><div id="loading-bar-wrapper"><div id="loading-bar" class="material"></div></div><div class="wrapper"><div class="nav-main container container--flex"><a class="logo flat-box" href="/">Shaokang's Blog</a><div class="menu navgation"><ul class="h-list"><li><a class="nav flat-box" href="/" id="home"><i class="fas fa-grin fa-fw"></i>&nbsp;Recent</a></li><li><a class="nav flat-box" href="/categories/" rel="nofollow" id="categories"><i class="fas fa-folder-open fa-fw"></i>&nbsp;Category</a></li><li><a class="nav flat-box" href="/tags/" rel="nofollow" id="tags"><i class="fas fa-hashtag fa-fw"></i>&nbsp;Tags</a></li><li><a class="nav flat-box" href="/archives/" rel="nofollow" id="archives"><i class="fas fa-archive fa-fw"></i>&nbsp;Archive</a></li></ul></div><div class="m_search"><form name="searchform" class="form u-search-form"><input type="text" class="input u-search-input" placeholder="Search"> <i class="icon fas fa-search fa-fw"></i></form></div><ul class="switcher h-list"><li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li><li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li></ul></div><div class="nav-sub container container--flex"><a class="logo flat-box"></a><ul class="switcher h-list"><li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li><li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li></ul></div></div></header><aside class="menu-phone"><header><nav class="menu navgation"><ul><li><a class="nav flat-box" href="/" id="home"><i class="fas fa-clock fa-fw"></i>&nbsp;Recent</a></li><li><a class="nav flat-box" href="/archives/" rel="nofollow" id="archives"><i class="fas fa-archive fa-fw"></i>&nbsp;Archive</a></li><li><a class="nav flat-box" href="/projects/" id="projects"><i class="fas fa-code-branch fa-fw"></i>&nbsp;Project</a></li><li><a class="nav flat-box" href="/categories/" rel="nofollow" id="categories"><i class="fas fa-folder-open fa-fw"></i>&nbsp;Category</a></li><li><a class="nav flat-box" href="/tags/" rel="nofollow" id="tags"><i class="fas fa-hashtag fa-fw"></i>&nbsp;Tags</a></li><li><a class="nav flat-box" href="/about/" rel="nofollow" id="about"><i class="fas fa-info-circle fa-fw"></i>&nbsp;About</a></li></ul></nav></header></aside><script>setLoadingBarProgress(40)</script></div><div class="l_body"><div class="body-wrapper"><div class="l_main"><article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost"><section class="meta"><div class="meta" id="header-meta"><h1 class="title"><a href="/2020/a-dialog-flow-app/">A dialog flow app</a></h1><div class="new-meta-box"><div class="new-meta-item author"><a href="https://shaokang.ga" rel="nofollow"><i class="fas fa-user" aria-hidden="true"></i><p>Shaokang Jiang</p></a></div><div class="new-meta-item date"><a class="notlink"><i class="fas fa-calendar-alt" aria-hidden="true"></i><p>12/07/2020</p></a></div><div class="new-meta-item category"><a href="/categories/Programs/Coursework/" rel="nofollow"><i class="fas fa-folder-open" aria-hidden="true"></i><p>Programs&nbsp;/&nbsp;Coursework</p></a></div></div><hr></div></section><section class="article typo"><div class="article-entry" itemprop="articleBody"><p>Dialogflow provided a easy to configured way to integrate the voice interaction with your application. By using their sample code, it is easy to implement and deploy to multiple different platform. But it also have problems such that wrong information matching, can not define intent/entity on the go, privacy issue, and etc. This is a course assignment done solely by me. More details in below:</p><a id="more"></a><p>This one requires the creation of dialogflow project on their official site by creating intent and entities. And in the local side, just create a locale server and enable webhook on the dialogflow website.</p><h3 id="key-terms"><a class="markdownIt-Anchor" href="#key-terms"></a> Key terms:</h3><p><code>agent</code> This is a nearly global variable, which contains the information user could get and will send to the server. It needs to be initialized in the beginning of the setting:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/'</span>, express.json(), (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> agent = <span class="keyword">new</span> WebhookClient(&#123; <span class="attr">request</span>: req, <span class="attr">response</span>: res &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> intentMap = <span class="keyword">new</span> <span class="built_in">Map</span>() <span class="comment">//and using an intentMap to match the intent and function to execute. like below: </span></span><br><span class="line">  intentMap.set(<span class="string">'Default Welcome Intent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) =&gt; </span>&#123;&#125;)<span class="comment">//Default Welcome Intent is the name</span></span><br><span class="line">  agent.handleRequest(intentMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>agent.add(message)</code> method to add return information.</p><blockquote><p><strong>Caution:</strong> In this method, multiple times of calling will concat information instead of random choosing and replying.</p></blockquote><p><code>agent.parameters.paraName</code> get access to the detected entity (named as <code>paraName</code>).</p><blockquote><p><strong>Caution:</strong> <code>paraName</code> might return a string that is totally not in your defined entity list. This one provides convenience but also loss the precise. So, be sure to have a good program that is able to handle those stuff correctly</p><p>In my case, there is a entity list defined as [cloth, dress, hat, …] (no this) and dialogflow detect the parameter with <code>this</code> as the value.</p></blockquote><p><code>agent.query</code> the entire sentence user said</p><p>There are other advanced stuff like <code>addContext()</code>, etc… Those four are enough to build an application.</p><h3 id="a-complete-simple-sample"><a class="markdownIt-Anchor" href="#a-complete-simple-sample"></a> A complete simple sample:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/'</span>, express.json(), (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> agent = <span class="keyword">new</span> WebhookClient(&#123; <span class="attr">request</span>: req, <span class="attr">response</span>: res &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> intentMap = <span class="keyword">new</span> <span class="built_in">Map</span>() <span class="comment">//and using an intentMap to match the intent and function to execute. like below: </span></span><br><span class="line">  intentMap.set(<span class="string">'Default Welcome Intent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) =&gt; </span>&#123;</span><br><span class="line">                agent.add(<span class="string">"aaa"</span> + <span class="string">":user words:"</span> + agent.query)</span><br><span class="line">                &#125;)<span class="comment">//Default Welcome Intent is the name</span></span><br><span class="line">  agent.handleRequest(intentMap)</span><br><span class="line">&#125;</span><br><span class="line">app.listen(process.env.PORT || <span class="number">8080</span>)</span><br></pre></td></tr></table></figure><h3 id="discussion"><a class="markdownIt-Anchor" href="#discussion"></a> Discussion</h3><h4 id="pros"><a class="markdownIt-Anchor" href="#pros"></a> Pros:</h4><ol><li>Super easy to use, a two hour learning is enough to build an application</li><li>Have a lot of sample</li><li>Have a more powerful training platform.</li><li>Can easily integrate into platforms and deliver to user.</li></ol><h4 id="cons"><a class="markdownIt-Anchor" href="#cons"></a> Cons:</h4><ol><li>Dialogflow provided a easy to configured way to integrate the voice interaction with most applications. But their compatibility focuses on google platform. Platform like <code>Expo</code> gets to eject to integrate with it.</li><li>Dialogflow will time out after 5 seconds, which means the server need to run everything super fast. But this is hard in some cases, when network are not good, or in some network limited area.</li><li>Entity extraction might match wrong and really broad keyword that backend do not know how to prevent, like match <code>this</code> with <code>dress</code>, personally thinking <code>Nlp.js</code> is a better tool, refer to <a href="https://shaokang.ga/2021/Nlp-js-in-Expo-usage/">Nlp.js in Expo usage</a> to see more about implementing on it.</li><li>Possible privacy issue.</li><li>It is impossible to define intent/entity based on user needs. Even though one model could work for majority people, personalization could make user feel much more comfortable to certain people. And this could eliminate training phrases as well.</li></ol><h3 id="entire-source-code"><a class="markdownIt-Anchor" href="#entire-source-code"></a> Entire source code:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; WebhookClient &#125; = <span class="built_in">require</span>(<span class="string">'dialogflow-fulfillment'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">'node-fetch'</span>)</span><br><span class="line"><span class="keyword">const</span> base64 = <span class="built_in">require</span>(<span class="string">'base-64'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> username = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">let</span> password = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">let</span> token = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">let</span> products;</span><br><span class="line"><span class="keyword">let</span> filtered;</span><br><span class="line"></span><br><span class="line">USE_LOCAL_ENDPOINT = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// set this flag to true if you want to use a local endpoint</span></span><br><span class="line"><span class="comment">// set this flag to false if you want to use the online endpoint</span></span><br><span class="line">ENDPOINT_URL = <span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> (USE_LOCAL_ENDPOINT) &#123;</span><br><span class="line">  ENDPOINT_URL = <span class="string">"http://127.0.0.1:5000"</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  ENDPOINT_URL = <span class="string">"XXX"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(ENDPOINT_URL + <span class="string">'/products'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> data.products) &#123;</span><br><span class="line">    fetch(ENDPOINT_URL + <span class="string">'/products/'</span> + i.id + <span class="string">"/tags"</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()).then(<span class="function"><span class="params">data1</span> =&gt;</span> &#123;</span><br><span class="line">      i[<span class="string">"tags"</span>] = data1.tags;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  products = data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">navigation</span>(<span class="params">back, dialogflow, page</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> request;</span><br><span class="line">  <span class="keyword">if</span> (page === <span class="literal">null</span>) &#123;</span><br><span class="line">    request = &#123;</span><br><span class="line">      method: <span class="string">'PUT'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        <span class="string">"back"</span>: back,</span><br><span class="line">        <span class="string">"dialogflowUpdated"</span>: dialogflow</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    request = &#123;</span><br><span class="line">      method: <span class="string">'PUT'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        <span class="string">"back"</span>: back,</span><br><span class="line">        <span class="string">"dialogflowUpdated"</span>: dialogflow,</span><br><span class="line">        <span class="string">"page"</span>: <span class="string">"/"</span> + page</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> serverReturn1 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application'</span>, request)</span><br><span class="line">  <span class="keyword">const</span> serverResponse1 = <span class="keyword">await</span> serverReturn1.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> request = &#123;</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      <span class="string">'Authorization'</span>: <span class="string">'Basic '</span> + base64.encode(username + <span class="string">':'</span> + password)</span><br><span class="line">    &#125;,</span><br><span class="line">    redirect: <span class="string">'follow'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> serverReturn = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/login'</span>, request)</span><br><span class="line">  <span class="keyword">if</span> (serverReturn.ok) &#123;</span><br><span class="line">    <span class="keyword">const</span> serverResponse = <span class="keyword">await</span> serverReturn.json()</span><br><span class="line">    token = serverResponse.token</span><br><span class="line"></span><br><span class="line">    request = &#123;</span><br><span class="line">      method: <span class="string">'PUT'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        <span class="string">"back"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"dialogflowUpdated"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"page"</span>: <span class="string">"/"</span> + username</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> serverReturn2 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/messages'</span>, &#123;</span><br><span class="line">      method: <span class="string">'DELETE'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    serverReturn2.json()</span><br><span class="line"></span><br><span class="line">    addUserMessage(message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> serverReturn1 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application'</span>, request)</span><br><span class="line">    <span class="keyword">const</span> serverResponse1 = <span class="keyword">await</span> serverReturn1.json()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//console.log(products)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    username = <span class="string">""</span>;</span><br><span class="line">    password = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"fail"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">addUserMessage</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> serverReturn2 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/messages'</span>, &#123;</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      <span class="string">'x-access-token'</span>: token</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      <span class="string">"isUser"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"date"</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString(),</span><br><span class="line">      <span class="string">"text"</span>: user</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> serverReturn2.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">addAgentMessage</span>(<span class="params">agent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> serverReturn2 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/messages'</span>, &#123;</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">      <span class="string">'x-access-token'</span>: token</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      <span class="string">"isUser"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">"date"</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString(),</span><br><span class="line">      <span class="string">"text"</span>: agent</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> serverReturn2.json()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'online'</span>))</span><br><span class="line">app.post(<span class="string">'/'</span>, express.json(), (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> agent = <span class="keyword">new</span> WebhookClient(&#123; <span class="attr">request</span>: req, <span class="attr">response</span>: res &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">welcome</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    agent.add(<span class="string">'Webhook works!'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(ENDPOINT_URL)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//console.log(products.products[0].tags);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line">      agent.add(<span class="string">"You have logged in as "</span> + username);</span><br><span class="line">      <span class="keyword">await</span> addAgentMessage(<span class="string">"You have logged in as "</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// You need to set this from `username` entity that you declare in DialogFlow</span></span><br><span class="line">    username = agent.parameters.username;</span><br><span class="line">    <span class="comment">// You need to set this from password entity that you declare in DialogFlow</span></span><br><span class="line">    password = agent.parameters.password;</span><br><span class="line">    <span class="keyword">await</span> getToken(agent.query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      agent.add(<span class="string">"login failed, try again with login"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Successfully logged in as "</span> + username);</span><br><span class="line">      addAgentMessage(<span class="string">"Successfully logged in as "</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loginStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span>)</span><br><span class="line">        agent.add(<span class="string">"You are not logged in. "</span>);</span><br><span class="line">      <span class="keyword">else</span> agent.add(<span class="string">"Please log in at first"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.3</span>) &#123;</span><br><span class="line">        agent.add(<span class="string">"You are "</span> + username);</span><br><span class="line">        <span class="keyword">await</span> addAgentMessage(<span class="string">"You are "</span> + username);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.6</span>) &#123;</span><br><span class="line">        agent.add(<span class="string">"You username is "</span> + username);</span><br><span class="line">        <span class="keyword">await</span> addAgentMessage(<span class="string">"You username is "</span> + username);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        agent.add(<span class="string">"Hello, "</span> + username);</span><br><span class="line">        <span class="keyword">await</span> addAgentMessage(<span class="string">"Hello, "</span> + username);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">queryCategories</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//console.log(agent.parameters.category);</span></span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line">    <span class="keyword">await</span> navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/"</span> + agent.parameters.category);</span><br><span class="line">    filtered = [];</span><br><span class="line">    <span class="keyword">let</span> k = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i.category.localeCompare(agent.parameters.category) === <span class="number">0</span>) &#123;</span><br><span class="line">        filtered.push(i);</span><br><span class="line">        k.push(i.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    agent.add(<span class="string">"I found "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" belongs to "</span> + agent.parameters.category)</span><br><span class="line">    addAgentMessage(<span class="string">"I found "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" belongs to "</span> + agent.parameters.category);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">filterTags</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/tags/'</span> + agent.parameters.tags, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line">      <span class="keyword">let</span> k = <span class="string">" "</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> filtered) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i.tags.indexOf(agent.parameters.tags) !== <span class="number">-1</span>) &#123;</span><br><span class="line">          k += i.name + <span class="string">", "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"Successfully add tag "</span> + agent.parameters.tags + <span class="string">", filtered items: "</span> + k)<span class="comment">//need filter and return something here</span></span><br><span class="line">      addAgentMessage(<span class="string">"Successfully add tag "</span> + agent.parameters.tags + <span class="string">", filtered items: "</span> + k)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Unknown problem happened"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Unknown problem happened"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">clearTags</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query)</span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/tags'</span>, &#123;</span><br><span class="line">      method: <span class="string">'DELETE'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line">      <span class="keyword">let</span> k = <span class="string">" "</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> filtered) &#123;</span><br><span class="line">        k += i.name + <span class="string">", "</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"Successfully cleared all tags filters, current items are "</span> + k)</span><br><span class="line">      addAgentMessage(<span class="string">"Successfully cleared all tags filters, current items are "</span> + k)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Unknown problem happened"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Unknown problem happened"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">queryCategoryTag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query)</span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/tags'</span>, &#123;</span><br><span class="line">      method: <span class="string">'DELETE'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/"</span> + agent.parameters.category);</span><br><span class="line">      filtered = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i.category.localeCompare(agent.parameters.category) === <span class="number">0</span>) &#123;</span><br><span class="line">          filtered.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> serve1 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/tags/'</span> + agent.parameters.tags, &#123;</span><br><span class="line">        method: <span class="string">'POST'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">'x-access-token'</span>: token</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">await</span> serve1.json()</span><br><span class="line">      <span class="keyword">if</span> (serve1.ok) &#123;</span><br><span class="line">        <span class="keyword">let</span> k = <span class="string">" "</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> filtered) &#123;</span><br><span class="line">          <span class="keyword">if</span> (i.tags.indexOf(agent.parameters.tags) !== <span class="number">-1</span>) &#123;</span><br><span class="line">            k += i.name + <span class="string">", "</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        agent.add(<span class="string">"Successfully add tag "</span> + agent.parameters.tags + <span class="string">", filtered items: "</span> + k)<span class="comment">//need filter and return something here</span></span><br><span class="line">        addAgentMessage(<span class="string">"Successfully add tag "</span> + agent.parameters.tags + <span class="string">", filtered items: "</span> + k)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        agent.add(<span class="string">"Unknown problem happened"</span>);</span><br><span class="line">        addAgentMessage(<span class="string">"Unknown problem happened"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Unknown problem happened"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Unknown problem happened"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">goBack</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query)</span><br><span class="line">    <span class="keyword">await</span> navigation(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">    agent.add(<span class="string">"Go back successfully"</span>);</span><br><span class="line">    <span class="keyword">await</span> addAgentMessage(<span class="string">"Go back successfully"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">productRating</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">      <span class="keyword">if</span> (agent.parameters.product.indexOf(i.name) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        id = i.id;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/products/'</span> + id + <span class="string">"/reviews"</span>)</span><br><span class="line">    <span class="keyword">let</span> reviews = <span class="keyword">await</span> serve.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (reviews.reviews.length !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//review exist</span></span><br><span class="line">      <span class="keyword">let</span> reviewText = [];</span><br><span class="line">      <span class="keyword">let</span> rating = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> reviews.reviews) &#123;</span><br><span class="line">        rating += i.stars;</span><br><span class="line">        <span class="keyword">if</span> (i.text.localeCompare(<span class="string">"&lt;Product Review Text&gt;"</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">          reviewText.push(<span class="string">"Title: "</span> + i.title)</span><br><span class="line">          reviewText.push(<span class="string">"Text: "</span> + i.text)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      agent.add(<span class="string">"This items has the average rating of "</span> + (rating / reviews.reviews.length).toFixed(<span class="number">2</span>) + <span class="string">". It also contains comments of the following: "</span> + reviewText.toString())</span><br><span class="line">      addAgentMessage(<span class="string">"This items has the average rating of "</span> + (rating / reviews.reviews.length).toFixed(<span class="number">2</span>) + <span class="string">". It also contains comments of the following: "</span> + reviewText.toString())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Review do not exist"</span>)</span><br><span class="line">      addAgentMessage(<span class="string">"Review do not exist"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">viewProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id;</span><br><span class="line">    <span class="keyword">let</span> catego;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">      <span class="keyword">if</span> (agent.parameters.product.toLocaleLowerCase().indexOf(i.name.toLocaleLowerCase()) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        id = i.id;</span><br><span class="line">        catego = i.category;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/products/'</span> + id + <span class="string">"/reviews"</span>)</span><br><span class="line">    <span class="keyword">let</span> reviews = <span class="keyword">await</span> serve.json()</span><br><span class="line"></span><br><span class="line">    navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/"</span> + catego + <span class="string">"/products/"</span> + id)</span><br><span class="line">    agent.add(<span class="string">"Navigate you to "</span> + agent.parameters.product + <span class="string">"page"</span>)</span><br><span class="line">    addAgentMessage(<span class="string">"Navigate you to "</span> + agent.parameters.product + <span class="string">"page"</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">addProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (agent.parameters.product.localeCompare(<span class="string">""</span>) === <span class="number">0</span> || agent.parameters.product.toLocaleLowerCase().indexOf(<span class="string">"product"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="comment">//get info from page</span></span><br><span class="line">      <span class="keyword">const</span> serverReturn2 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/'</span>, &#123;</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">'x-access-token'</span>: token</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//page field</span></span><br><span class="line">      <span class="keyword">let</span> result = <span class="keyword">await</span> serverReturn2.json()</span><br><span class="line">      result = result.page.split(<span class="string">"/"</span>);</span><br><span class="line">      <span class="keyword">if</span> (result.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result[result.length - <span class="number">2</span>].localeCompare(<span class="string">"products"</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">//normal add</span></span><br><span class="line">          id = <span class="built_in">parseInt</span>(result[result.length - <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          agent.add(<span class="string">"You are not in a product page"</span>);</span><br><span class="line">          addAgentMessage(<span class="string">"You are not in a product page"</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        agent.add(<span class="string">"You are not in a product page"</span>);</span><br><span class="line">        addAgentMessage(<span class="string">"You are not in a product page"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> toFind = agent.parameters.product.toLocaleLowerCase();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">        <span class="keyword">let</span> tocompare = i.name.toLocaleLowerCase();</span><br><span class="line">        <span class="keyword">if</span> (toFind.indexOf(tocompare) !== <span class="number">-1</span>) &#123;</span><br><span class="line">          id = i.id;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id === <span class="literal">null</span>) &#123;</span><br><span class="line">      agent.add(<span class="string">"Product name has problem"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Product name has problem"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//adding</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/products/'</span> + id, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//page field</span></span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line">      agent.add(<span class="string">"Successfully added 1 of "</span> + agent.parameters.product + <span class="string">" to your cart"</span>)</span><br><span class="line">      addAgentMessage(<span class="string">"Successfully added 1 of "</span> + agent.parameters.product + <span class="string">" to your cart"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanCart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/products/'</span>, &#123;</span><br><span class="line">      method: <span class="string">'DELETE'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line">      agent.add(<span class="string">"Successfully cleaned your cart"</span>)</span><br><span class="line">      addAgentMessage(<span class="string">"Successfully cleaned your cart"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">removeProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> products.products) &#123;</span><br><span class="line">      <span class="keyword">if</span> (agent.parameters.product.toLocaleLowerCase().indexOf(i.name.toLocaleLowerCase()) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        id = i.id;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id === <span class="literal">null</span>) &#123;</span><br><span class="line">      agent.add(<span class="string">"Product name has problem"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Product name has problem"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/products/'</span> + id, &#123;</span><br><span class="line">      method: <span class="string">'DELETE'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> serve.json()</span><br><span class="line">    <span class="keyword">if</span> (serve.ok) &#123;</span><br><span class="line">      agent.add(<span class="string">"Successfully removed 1 of "</span> + agent.parameters.product + <span class="string">" from your cart"</span>)</span><br><span class="line">      addAgentMessage(<span class="string">"Successfully removed 1 of "</span> + agent.parameters.product + <span class="string">" from your cart"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      agent.add(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Failed with server problem"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">navigatePage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> findContent = agent.parameters.pages.toLocaleLowerCase();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"home"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      navigation(<span class="literal">false</span>, <span class="literal">true</span>, username)</span><br><span class="line">      agent.add(<span class="string">"Navigating you to home..."</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Navigating you to home..."</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"review"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/cart-review"</span>)</span><br><span class="line">      agent.add(<span class="string">"Navigating you to cart-review..."</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Navigating you to cart-review..."</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"confirm"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> serverReturn2 = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/'</span>, &#123;</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">'x-access-token'</span>: token</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//page field</span></span><br><span class="line">      <span class="keyword">let</span> result = <span class="keyword">await</span> serverReturn2.json()</span><br><span class="line">      result = result.page.split(<span class="string">"/"</span>);</span><br><span class="line">      <span class="keyword">if</span> (result.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result[result.length - <span class="number">1</span>].localeCompare(<span class="string">"cart-review"</span>) === <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">          navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/cart-confirmed"</span>)</span><br><span class="line">          agent.add(<span class="string">"Navigating you to cart-confirmed..."</span>);</span><br><span class="line">          addAgentMessage(<span class="string">"Navigating you to cart-confirmed..."</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          agent.add(<span class="string">"You are not in a cart review page"</span>);</span><br><span class="line">          addAgentMessage(<span class="string">"You are not in a cart review page"</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        agent.add(<span class="string">"You are not in a cart review page"</span>);</span><br><span class="line">        addAgentMessage(<span class="string">"You are not in a cart review page"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"cart"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/cart"</span>)</span><br><span class="line">      agent.add(<span class="string">"Navigating you to cart..."</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Navigating you to cart..."</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">cartInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.localeCompare(<span class="string">""</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//ensure user is logged in</span></span><br><span class="line">      agent.add(<span class="string">"Invalid visit, please login first"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> addUserMessage(agent.query);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> serve = <span class="keyword">await</span> fetch(ENDPOINT_URL + <span class="string">'/application/products/'</span>, &#123;</span><br><span class="line">      method: <span class="string">'GET'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'x-access-token'</span>: token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cart = <span class="keyword">await</span> serve.json();</span><br><span class="line">    cart = cart.products;</span><br><span class="line">    navigation(<span class="literal">false</span>, <span class="literal">true</span>, username + <span class="string">"/cart"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> findContent = agent.parameters.cartInformation.toLocaleLowerCase();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"number"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> k = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">        k += i.count;</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"You have "</span> + k + <span class="string">" items in your cart"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"You have "</span> + k + <span class="string">" items in your cart"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"cost"</span>) !== <span class="number">-1</span> || findContent.indexOf(<span class="string">"price"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> k = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">        k += i.count * i.price;</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"Total price is "</span> + k.toFixed(<span class="number">2</span>) + <span class="string">" in your cart"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"Total price is "</span> + k.toFixed(<span class="number">2</span>) + <span class="string">" in your cart"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"type"</span>) !== <span class="number">-1</span>) &#123;<span class="comment">//assume to be category</span></span><br><span class="line">      <span class="keyword">let</span> k = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k.indexOf(i.category) === <span class="number">-1</span>) &#123;</span><br><span class="line">          k.push(i.category);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"You have items belong to the following categories "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" in your cart"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"You have items belong to the following categories "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" in your cart"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (findContent.indexOf(<span class="string">"item"</span>) !== <span class="number">-1</span>) &#123;<span class="comment">//assume to be items name + count</span></span><br><span class="line">      <span class="keyword">let</span> k = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">        k.push(i.count + <span class="string">" of "</span> + i.name);</span><br><span class="line">      &#125;</span><br><span class="line">      agent.add(<span class="string">"You have items "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" in your cart"</span>);</span><br><span class="line">      addAgentMessage(<span class="string">"You have items "</span> + k.length === <span class="number">0</span> ? <span class="string">"nothing"</span> : k.toString() + <span class="string">" in your cart"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//entering default, all info</span></span><br><span class="line">    <span class="keyword">let</span> toSend = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">let</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">      k += i.count;</span><br><span class="line">    &#125;</span><br><span class="line">    toSend += <span class="string">"You have "</span> + k + <span class="string">" items in your cart "</span>;</span><br><span class="line"></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">      k += i.count * i.price;</span><br><span class="line">    &#125;</span><br><span class="line">    toSend += <span class="string">"Total price is "</span> + k.toFixed(<span class="number">2</span>) + <span class="string">" in your cart "</span>;</span><br><span class="line"></span><br><span class="line">    k = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">      <span class="keyword">if</span> (k.indexOf(i.category) === <span class="number">-1</span>) &#123;</span><br><span class="line">        k.push(i.category);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    toSend += <span class="string">"You have items belong to the following categories "</span> + k.toString() + <span class="string">" in your cart"</span>;</span><br><span class="line"></span><br><span class="line">    k = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> cart) &#123;</span><br><span class="line">      k.push(i.count + <span class="string">" of "</span> + i.name);</span><br><span class="line">    &#125;</span><br><span class="line">    toSend += <span class="string">"You have items "</span> + k.toString() + <span class="string">" in your cart"</span>;</span><br><span class="line"></span><br><span class="line">    agent.add(toSend);</span><br><span class="line">    addAgentMessage(toSend);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> intentMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  intentMap.set(<span class="string">'Default Welcome Intent'</span>, welcome)</span><br><span class="line">  <span class="comment">// You will need to declare this `Login` content in DialogFlow to make this work</span></span><br><span class="line"></span><br><span class="line">  intentMap.set(<span class="string">'LoginStatus'</span>, loginStatus)</span><br><span class="line">  intentMap.set(<span class="string">'login'</span>, login)</span><br><span class="line">  intentMap.set(<span class="string">'queryCategories'</span>, queryCategories)</span><br><span class="line">  intentMap.set(<span class="string">'filterTags'</span>, filterTags)</span><br><span class="line">  intentMap.set(<span class="string">'clearTags'</span>, clearTags)</span><br><span class="line">  intentMap.set(<span class="string">'queryCategoryTag'</span>, queryCategoryTag)</span><br><span class="line">  intentMap.set(<span class="string">'goBack'</span>, goBack)</span><br><span class="line">  intentMap.set(<span class="string">'productRating'</span>, productRating)</span><br><span class="line">  intentMap.set(<span class="string">'viewProduct'</span>, viewProduct)</span><br><span class="line">  intentMap.set(<span class="string">'addProduct'</span>, addProduct)</span><br><span class="line">  intentMap.set(<span class="string">'cleanCart'</span>, cleanCart)</span><br><span class="line">  intentMap.set(<span class="string">'removeProduct'</span>, removeProduct)</span><br><span class="line">  intentMap.set(<span class="string">'removeProduct'</span>, removeProduct)</span><br><span class="line">  intentMap.set(<span class="string">'navigatePage'</span>, navigatePage)</span><br><span class="line">  intentMap.set(<span class="string">'cartInfo'</span>, cartInfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  agent.handleRequest(intentMap)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(process.env.PORT || <span class="number">8080</span>)</span><br></pre></td></tr></table></figure></div><section class="meta" id="footer-meta"><hr><div class="new-meta-box"><div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-01-15T17:17:08-06:00"><a class="notlink"><i class="fas fa-clock" aria-hidden="true"></i><p>last updated at Jan 15, 2021</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/Dialogflow/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>Dialogflow</p></a></div></div></section><div class="prev-next"><section class="prev"><span class="art-item-left"><h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;Previous</h6><h4><a href="/2020/projects/Publication-of-Financial-website/" rel="prev" title="Publication for Financial website">Publication for Financial website</a></h4><h6 class="tags"><a class="tag" href="/tags/Expo/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Expo</a> <a class="tag" href="/tags/MIP/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>MIP</a> <a class="tag" href="/tags/Nlp-js/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Nlp.js</a> <a class="tag" href="/tags/Website/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Website</a> <a class="tag" href="/tags/JS/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>JS</a> <a class="tag" href="/tags/HTML/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>HTML</a> <a class="tag" href="/tags/ejs/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>ejs</a></h6></span></section><section class="next"><span class="art-item-right" aria-hidden="true"><h6>Next&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6><h4><a href="/2020/projects/Build-Cloudflare-worker-with-endpoint/" rel="prev" title="Build Cloudflare worker with endpoint">Build Cloudflare worker with endpoint</a></h4><h6 class="tags"><a class="tag" href="/tags/JS/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>JS</a></h6></span></section></div></section></article><article class="post white-box comments"><section class="article typo"><h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;Comments</h4><section id="comments"><div id="valine_container" class="valine_thread"><i class="fas fa-spinner fa-spin fa-fw"></i></div></section></section></article><script>window.subData={title:"A dialog flow app",tools:!0}</script></div><aside class="l_side"><section class="widget toc-wrapper"><header class="material"><div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;TOC</div><div class="wrapper"><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div></header><div class="content material"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#key-terms"><span class="toc-text">Key terms:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a-complete-simple-sample"><span class="toc-text">A complete simple sample:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#discussion"><span class="toc-text">Discussion</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pros"><span class="toc-text">Pros:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cons"><span class="toc-text">Cons:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#entire-source-code"><span class="toc-text">Entire source code:</span></a></li></ol></div></section><section class="widget category"><header class="material"><div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;Categories</div><a class="rightBtn" rel="nofollow" href="/categories/" title="categories/"><i class="fas fa-expand-arrows-alt fa-fw"></i></a></header><div class="content material"><ul class="entry"><li><a class="flat-box" title="/categories/Cryptocurrency-Application/" href="/categories/Cryptocurrency-Application/"><div class="name">Cryptocurrency Application</div><div class="badge">(4)</div></a></li><li><a class="flat-box child" title="/categories/Cryptocurrency-Application/Bitcoin/" href="/categories/Cryptocurrency-Application/Bitcoin/"><div class="name">Bitcoin</div><div class="badge">(1)</div></a></li><li><a class="flat-box child" title="/categories/Cryptocurrency-Application/EOSIO/" href="/categories/Cryptocurrency-Application/EOSIO/"><div class="name">EOSIO</div><div class="badge">(3)</div></a></li><li><a class="flat-box" title="/categories/Expo/" href="/categories/Expo/"><div class="name">Expo</div><div class="badge">(4)</div></a></li><li><a class="flat-box" title="/categories/Programs/" href="/categories/Programs/"><div class="name">Programs</div><div class="badge">(5)</div></a></li><li><a class="flat-box child" title="/categories/Programs/Coursework/" href="/categories/Programs/Coursework/"><div class="name">Coursework</div><div class="badge">(3)</div></a></li><li><a class="flat-box child" title="/categories/Programs/tools/" href="/categories/Programs/tools/"><div class="name">tools</div><div class="badge">(2)</div></a></li><li><a class="flat-box" title="/categories/optimization/" href="/categories/optimization/"><div class="name">optimization</div><div class="badge">(4)</div></a></li><li><a class="flat-box" title="/categories/website/" href="/categories/website/"><div class="name">website</div><div class="badge">(9)</div></a></li><li><a class="flat-box child" title="/categories/website/Cloudflare-Worker/" href="/categories/website/Cloudflare-Worker/"><div class="name">Cloudflare Worker</div><div class="badge">(2)</div></a></li><li><a class="flat-box child" title="/categories/website/Hexo/" href="/categories/website/Hexo/"><div class="name">Hexo</div><div class="badge">(2)</div></a></li><li><a class="flat-box child" title="/categories/website/JS/" href="/categories/website/JS/"><div class="name">JS</div><div class="badge">(1)</div></a></li></ul></div></section><section class="widget tagcloud"><header class="material"><div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;Hot Tags</div><a class="rightBtn" rel="nofollow" href="/tags/" title="tags/"><i class="fas fa-expand-arrows-alt fa-fw"></i></a></header><div class="content material"><a href="/tags/AES/" style="font-size:14px;color:#999">AES</a> <a href="/tags/Bitcoin/" style="font-size:14px;color:#999">Bitcoin</a> <a href="/tags/Dialogflow/" style="font-size:14px;color:#999">Dialogflow</a> <a href="/tags/Expo/" style="font-size:22px;color:#636363">Expo</a> <a href="/tags/GAMS/" style="font-size:16px;color:#8b8b8b">GAMS</a> <a href="/tags/HTML/" style="font-size:18px;color:#7e7e7e">HTML</a> <a href="/tags/JFoenix/" style="font-size:14px;color:#999">JFoenix</a> <a href="/tags/JS/" style="font-size:20px;color:#707070">JS</a> <a href="/tags/Java/" style="font-size:16px;color:#8b8b8b">Java</a> <a href="/tags/JavaFX/" style="font-size:16px;color:#8b8b8b">JavaFX</a> <a href="/tags/MIP/" style="font-size:24px;color:#555">MIP</a> <a href="/tags/Nlp-js/" style="font-size:20px;color:#707070">Nlp.js</a> <a href="/tags/Notes/" style="font-size:14px;color:#999">Notes</a> <a href="/tags/SQL/" style="font-size:16px;color:#8b8b8b">SQL</a> <a href="/tags/Self-learning/" style="font-size:14px;color:#999">Self learning</a> <a href="/tags/Website/" style="font-size:20px;color:#707070">Website</a> <a href="/tags/choco-solver/" style="font-size:14px;color:#999">choco-solver</a> <a href="/tags/ejs/" style="font-size:16px;color:#8b8b8b">ejs</a> <a href="/tags/eos/" style="font-size:18px;color:#7e7e7e">eos</a> <a href="/tags/eos-cdt/" style="font-size:18px;color:#7e7e7e">eos.cdt</a> <a href="/tags/eosio-contracts/" style="font-size:18px;color:#7e7e7e">eosio.contracts</a> <a href="/tags/jsLpsolver/" style="font-size:14px;color:#999">jsLpsolver</a></div></section><section class="widget related_posts"><header class="material"><div><i class="fas fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;Related Posts</div></header><div class="content material"><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/2020/Simple-autocorrect-with-Bigram/" title="Simple autocorrect with Bigram" rel="bookmark">Simple autocorrect with Bigram</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/2020/projects/A-JavaFx-project/" title="A JavaFx project" rel="bookmark">A JavaFx project</a></h3></div></li></ul></div></section></aside><footer id="footer" class="clearfix"><div class="footer"></div><br><div class="social-wrapper"><a href="mailto:huangsk100@gmail.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a> <a href="https://github.com/ShaokangJiang" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a> <a href="https://github.com/sjiang97" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a></div><br><div><p>Powered by <a href="https://hexo.io/">Hexo</a>. Use <a href="https://xaoxuu.com/wiki/material-x/">Material-X</a> as theme.</p></div></footer><script>setLoadingBarProgress(80)</script><script>setLoadingBarProgress(60)</script></div><a class="s-top fas fa-arrow-up fa-fw" href="javascript:void(0)"></a></div><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script>var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="hexo",ROOT="/";ROOT.endsWith("/")||(ROOT+="/")</script><script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script><script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script><script type="text/javascript">$((function(){0!==$(".reveal").length&&ScrollReveal({distance:0}).reveal(".reveal")}))</script><script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script><script type="text/javascript">$((function(){Waves.attach(".flat-btn",["waves-button"]),Waves.attach(".float-btn",["waves-button","waves-float"]),Waves.attach(".float-btn-light",["waves-button","waves-float","waves-light"]),Waves.attach(".flat-box",["waves-block"]),Waves.attach(".float-box",["waves-block","waves-float"]),Waves.attach(".waves-image"),Waves.init()}))</script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script><script type="text/javascript">$((function(){$(".cover").backstretch(["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],{duration:"6000",fade:"2500"})}))</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-valine@1.3.4/js/valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter((function(i){return GUEST_INFO.indexOf(i)>-1})),notify=!1,verify=!1,valine=new Valine;valine.init({el:"#valine_container",notify:notify,verify:verify,guest_info:guest_info,appId:"g0v2qyGEhGys4wGpCLsKkerW-gzGzoHsz",appKey:"Sceumpu0A14EiY5RR3HtsCFx",placeholder:"",pageSize:"10",avatar:"mp",lang:"en",highlight:"false"})</script><script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.4.19/js/app.js"></script><script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.4.19/js/search.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script>let COPY_SUCCESS="Copied",COPY_FAILURE="Copy failed";window,document,function(){$(".highlight .code pre").before('<button class="btn-copy" data-clipboard-snippet="">  <i class="fa fa-copy"></i><span>Copy</span></button>');var o=new ClipboardJS(".btn-copy",{target:function(o){return o.nextElementSibling}});o.on("success",(function(o){console.info("Action:",o.action),console.info("Text:",o.text),console.info("Trigger:",o.trigger),success_prompt(COPY_SUCCESS),o.clearSelection()})),o.on("error",(function(o){console.error("Action:",o.action),console.error("Trigger:",o.trigger),fail_prompt(COPY_FAILURE)}))}();var prompt=function(o,n,t){n=void 0===n?"alert-success":n,t=void 0===t?1500:1e3*t,$("<div>").appendTo("body").addClass("alert "+n).html(o).show().delay(t).fadeOut()},success_prompt=function(o,n){prompt(o,"alert-success",n)},fail_prompt=function(o,n){prompt(o,"alert-danger",n)},warning_prompt=function(o,n){prompt(o,"alert-warning",n)},info_prompt=function(o,n){prompt(o,"alert-info",n)}</script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>let LAZY_LOAD_IMAGE="";$(".article-entry").find("fancybox").find("img").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("src")),LAZY_LOAD_IMAGE&&$(t).attr("href",$(this).attr("data-original")),$(this).wrap(t)}))</script><script>setLoadingBarProgress(100)</script></body></html>